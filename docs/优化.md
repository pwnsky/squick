# 优化


## CPU 占用优化

CPU在Linux平台占用比较高，在Windows上通过VS进行调试检测，发现CPU有异常突起，如下：

<img src="./images/optimize_0.png" alt="img" style="zoom: 50%;" />

通过最终优化调整如下：

<img src="./images/optimize_1.png" alt="img" style="zoom: 50%;" />

具体追踪，对CPU占用情况进行捕获，发现如下

<img src="./images/optimize_2.png" alt="img" style="zoom: 50%;" />

定位到是 ThreadTask 类的构造函数和析构函数调用次数特别频繁。

<img src="./images/optimize_3.png" alt="img" style="zoom: 50%;" />

以上定位到该代码，发现，不管是否获取到线程任务，都会触发该对象的构造和析构函数，所以解决方案我们将其临时变量移动到循环外，避免多次频繁调用构造和析构函数。

<img src="./images/optimize_4.png" alt="img" style="zoom: 50%;" />

以上就是优化方案了。


